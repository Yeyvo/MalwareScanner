# Infrastructure

## Setup üèó

- **Install Terraform**

Visit the official documentation [here](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli) for more information on how to install Terraform

- **Install AWS-CLI**

Visit the official documentation [here](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html) for more information on how to install AWS-cli

- **Create access keys for an IAM user**

  1.  Sign in to the AWS Management Console and open the IAM console at [https://console.aws.amazon.com/iam/](https://console.aws.amazon.com/iam/).
  2.  In the navigation pane, choose Users.
  3.  Choose the name of the user whose access keys you want to create, and then choose the Security credentials tab.
  4.  In the Access keys section, choose Create access key.
  5.  To view the new access key pair, choose Show. You will not have access to the secret access key again after this dialog box closes. Your credentials will look something like this:

      - Access key ID: AKIAIOSFODNN7EXAMPLE
      - Secret access key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

- **Configure AWS-CLI**

Visit the official documentation [here](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html) for more information on how to configure environement variables for AWS-cli

- **Initialise the Terraform project** üß≠

```bash
terraform init
```

## Usage

- **Deploy the infrastructure** üèó

```bash
terraform apply
```

- **Destroy the infrastructure** üè¥‚Äç‚ò†Ô∏è

```bash
terraform destroy
```

- **Destroy the infrastructure** üè¥‚Äç‚ò†Ô∏è

connect to the main server (on aws) and execute this command with your credentials

```bash
sudo su
ifconfig eth1 up

export AWS_ACCESS_KEY_ID=YOUR_ACCESS_KEY_ID
export AWS_SECRET_ACCESS_KEY=YOUR_SECRET_ACCESS_KEY
export AWS_DEFAULT_REGION=us-west-2

cd MalwareScanner/Server
source venv/bin/activate
pip install -r requirements.txt
python app.py

```

## Be carefull üößüö¶ :

Provisioning of the Main Server may fail on windows hosts so when the pem file appears use WSL to change permission level of the file to 400

```bash
chmod 400 ./.ssh/MainSanbServer_private_key.pem
```

If it's still not working make sure to check [this](https://superuser.com/questions/1323645/unable-to-change-file-permissions-on-ubuntu-bash-for-windows-10) first before reporting any issue.
